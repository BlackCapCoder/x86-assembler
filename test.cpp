#include "assembler.h"
#include "executableBuffer.h"
#include <iostream>
#include <cassert>

auto buf = ExecutableBuffer ();
Assembler a { buf };


bool shouldBe (std::string str)
{
  std::string hex = buf.to_hex ();
  buf.clear();

  if (hex == str) return true;

  std::cout << hex << " should be " << str << std::endl;


  return false;
}

int main (void)
{
  using namespace Registers;

  a.xchg   (r8d, r8d);                  assert(shouldBe("4587c0"));
  a.xchg   (r9d, r10d);                 assert(shouldBe("4587d1"));
  a.cmovz  (r8w, r8w);                  assert(shouldBe("66450f44c0"));
  a.cmovz  (r8w, r9w);                  assert(shouldBe("66450f44c1"));
  a.cmovz  (r9w, r15w);                 assert(shouldBe("66450f44cf"));
  a.inc    (r15);                       assert(shouldBe("49ffc7"));
  a.adc    (al, Imm8{0xab});            assert(shouldBe("14ab"));
  a.adc    (r11w, Imm16{0xffff});       assert(shouldBe("664181d3ffff"));
  a.adc    (M16{r15w}, r8w);            assert(shouldBe("66451107"));
  a.adc    (M16{r8w}, r15w);            assert(shouldBe("66451138"));
  a.adc    (M16{r15w}, Imm8{0xf});      assert(shouldBe("664183170f"));
  a.adc    (M16{r8w}, Imm16{0xffff});   assert(shouldBe("66418110ffff"));
  a.adc    (M16{r9w}, Imm16{0xffff});   assert(shouldBe("66418111ffff"));
  a.adc    (M32{r8d}, Imm32{0xffffff}); assert(shouldBe("67418110ffffff00"));
  a.adc    (M32{r15d}, Imm8{0xf});      assert(shouldBe("674183170f"));
  a.adc    (M64{r8}, Imm32{0xfffff});   assert(shouldBe("498110ffff0f00"));
  a.adc    (M64{r8}, Imm8{0xf});        assert(shouldBe("4983100f"));
  a.adc    (M64{r11}, Imm8{0xf});       assert(shouldBe("4983130f")); // todo: r13
  a.add    (eax, Imm32{0xabcd});        assert(shouldBe("05cdab0000"));
  a.add    (M16{r14w }, Imm8{0xa});     assert(shouldBe("664183060a"));
  a.ror    (M64{r10 }, cl );            assert(shouldBe("49d30a"));
  a.psrad  (xmm0, Imm8{0xa});           assert(shouldBe("660f72e00a"));
  a.adc    (r8w, M16{r11w});            assert(shouldBe("66451303"));
  a.movdqa (xmm3, M128{xmm2});         assert(shouldBe("660f6f1a"));
  a.movdqa (xmm3, xmm7);               assert(shouldBe("660f6fdf"));
  a.movdqa (M128{xmm2}, xmm4);         assert(shouldBe("660f7f22"));
  a.movd   (xmm6, M32{r8d});             assert(shouldBe("6766410f6e30"));
  a.movd   (xmm1, M32{r11d});            assert(shouldBe("6766410f6e0b"));
  // a.movd (xmm1, M64{r11}); assert(shouldBe("66410f6e0b"));


  a.ret();                            assert(shouldBe("c3"));
  a.nop();                            assert(shouldBe("90"));
  a.pushfq();                         assert(shouldBe("9c"));
  a.popfq();                          assert(shouldBe("9d"));
  a.cmc();                            assert(shouldBe("f5"));
  a.clc();                            assert(shouldBe("f8"));
  a.stc();                            assert(shouldBe("f9"));
  a.cli();                            assert(shouldBe("fa"));
  a.sti();                            assert(shouldBe("fb"));
  a.cld();                            assert(shouldBe("fc"));
  a.inc(M16{r8w});                    assert(shouldBe("6641ff00"));
  a.inc(M32{r8d});                    assert(shouldBe("6741ff00"));
  a.inc(M64{r8});                     assert(shouldBe("49ff00"));
  a.inc(M8{r8b});                     assert(shouldBe("41fe00"));
  a.inc(r8w);                         assert(shouldBe("6641ffc0"));
  a.inc(r8d);                         assert(shouldBe("41ffc0"));
  a.inc(r8);                          assert(shouldBe("49ffc0"));
  a.inc(r8b);                         assert(shouldBe("41fec0"));
  a.dec(M16{r8w});                    assert(shouldBe("6641ff08"));
  a.dec(M32{r8d});                    assert(shouldBe("6741ff08"));
  a.dec(M64{r8});                     assert(shouldBe("49ff08"));
  a.dec(M8{r8b});                     assert(shouldBe("41fe08"));
  a.dec(r8w);                         assert(shouldBe("6641ffc8"));
  a.dec(r8d);                         assert(shouldBe("41ffc8"));
  a.dec(r8);                          assert(shouldBe("49ffc8"));
  a.dec(r8b);                         assert(shouldBe("41fec8"));
  a.not_(M16{r8w});                   assert(shouldBe("6641f710"));
  a.not_(M32{r8d});                   assert(shouldBe("6741f710"));
  a.not_(M64{r8});                    assert(shouldBe("49f710"));
  a.not_(M8{r8b});                    assert(shouldBe("41f610"));
  a.not_(r8w);                        assert(shouldBe("6641f7d0"));
  a.not_(r8d);                        assert(shouldBe("41f7d0"));
  a.not_(r8);                         assert(shouldBe("49f7d0"));
  a.not_(r8b);                        assert(shouldBe("41f6d0"));
  a.neg(M16{r8w});                    assert(shouldBe("6641f718"));
  a.neg(M32{r8d});                    assert(shouldBe("6741f718"));
  a.neg(M64{r8});                     assert(shouldBe("49f718"));
  a.neg(M8{r8b});                     assert(shouldBe("41f618"));
  a.neg(r8w);                         assert(shouldBe("6641f7d8"));
  a.neg(r8d);                         assert(shouldBe("41f7d8"));
  a.neg(r8);                          assert(shouldBe("49f7d8"));
  a.neg(r8b);                         assert(shouldBe("41f6d8"));
  a.bswap(r8d);                       assert(shouldBe("410fc8"));
  a.bswap(r8);                        assert(shouldBe("490fc8"));
  a.bsf(r8w,M16{r8w});                assert(shouldBe("66450fbc00"));
  a.bsf(r8w,r8w);                     assert(shouldBe("66450fbcc0"));
  a.bsf(r8d,M32{r8d});                assert(shouldBe("67450fbc00"));
  a.bsf(r8d,r8d);                     assert(shouldBe("450fbcc0"));
  a.bsf(r8,M64{r8});                  assert(shouldBe("4d0fbc00"));
  a.bsf(r8,r8);                       assert(shouldBe("4d0fbcc0"));
  a.bsr(r8w,M16{r8w});                assert(shouldBe("66450fbd00"));
  a.bsr(r8w,r8w);                     assert(shouldBe("66450fbdc0"));
  a.bsr(r8d,M32{r8d});                assert(shouldBe("67450fbd00"));
  a.bsr(r8d,r8d);                     assert(shouldBe("450fbdc0"));
  a.bsr(r8,M64{r8});                  assert(shouldBe("4d0fbd00"));
  a.bsr(r8,r8);                       assert(shouldBe("4d0fbdc0"));
  a.bt(M16{r8w},r8w);                 assert(shouldBe("66450fa300"));
  a.bt(M32{r8d},r8d);                 assert(shouldBe("67450fa300"));
  a.bt(M64{r8},r8);                   assert(shouldBe("4d0fa300"));
  a.bt(r8w,r8w);                      assert(shouldBe("66450fa3c0"));
  a.bt(r8d,r8d);                      assert(shouldBe("450fa3c0"));
  a.bt(r8,r8);                        assert(shouldBe("4d0fa3c0"));
  a.add(al,Imm8{0x0f});               assert(shouldBe("040f"));
  a.add(ax,Imm16{0xffff});            assert(shouldBe("6605ffff"));
  a.add(eax,Imm32{0xffffffff});       assert(shouldBe("05ffffffff"));
  a.add(M16{r8w},Imm16{0xffff});      assert(shouldBe("66418100ffff"));
  a.add(M16{r8w},Imm8{0x0f});         assert(shouldBe("664183000f"));
  a.add(M16{r8w},r8w);                assert(shouldBe("66450100"));
  a.add(M32{r8d},Imm32{0xffffffff});  assert(shouldBe("67418100ffffffff"));
  a.add(M32{r8d},Imm8{0x0f});         assert(shouldBe("674183000f"));
  a.add(M32{r8d},r8d);                assert(shouldBe("67450100"));
  a.add(M64{r8},Imm32{0xffffffff});   assert(shouldBe("498100ffffffff"));
  a.add(M64{r8},Imm8{0x0f});          assert(shouldBe("4983000f"));
  a.add(M64{r8},r8);                  assert(shouldBe("4d0100"));
  a.add(M8{r8b},Imm8{0x0f});          assert(shouldBe("4180000f"));
  a.add(M8{r8b},r8b);                 assert(shouldBe("450000"));
  a.add(r8w,Imm16{0xffff});           assert(shouldBe("664181c0ffff"));
  a.add(r8w,Imm8{0x0f});              assert(shouldBe("664183c00f"));
  a.add(r8w,M16{r8w});                assert(shouldBe("66450300"));
  a.add(r8w,r8w);                     assert(shouldBe("664501c0"));
  a.add(r8d,Imm32{0xffffffff});       assert(shouldBe("4181c0ffffffff"));
  a.add(r8d,Imm8{0x0f});              assert(shouldBe("4183c00f"));
  a.add(r8d,M32{r8d});                assert(shouldBe("67450300"));
  a.add(r8d,r8d);                     assert(shouldBe("4501c0"));
  a.add(r8,Imm32{0xffffffff});        assert(shouldBe("4981c0ffffffff"));
  a.add(r8,Imm8{0x0f});               assert(shouldBe("4983c00f"));
  a.add(r8,M64{r8});                  assert(shouldBe("4d0300"));
  a.add(r8,r8);                       assert(shouldBe("4d01c0"));
  a.add(r8b,Imm8{0x0f});              assert(shouldBe("4180c00f"));
  a.add(r8b,M8{r8b});                 assert(shouldBe("450200"));
  a.add(rax,Imm32{0xffffffff});       assert(shouldBe("4805ffffffff"));
  a.or_(al,Imm8{0x0f});               assert(shouldBe("0c0f"));
  a.or_(ax,Imm16{0xffff});            assert(shouldBe("660dffff"));
  a.or_(eax,Imm32{0xffffffff});       assert(shouldBe("0dffffffff"));
  a.or_(M16{r8w},Imm16{0xffff});      assert(shouldBe("66418108ffff"));
  a.or_(M16{r8w},Imm8{0x0f});         assert(shouldBe("664183080f"));
  a.or_(M16{r8w},r8w);                assert(shouldBe("66450900"));
  a.or_(M32{r8d},Imm32{0xffffffff});  assert(shouldBe("67418108ffffffff"));
  a.or_(M32{r8d},Imm8{0x0f});         assert(shouldBe("674183080f"));
  a.or_(M32{r8d},r8d);                assert(shouldBe("67450900"));
  a.or_(M64{r8},Imm32{0xffffffff});   assert(shouldBe("498108ffffffff"));
  a.or_(M64{r8},Imm8{0x0f});          assert(shouldBe("4983080f"));
  a.or_(M64{r8},r8);                  assert(shouldBe("4d0900"));
  a.or_(M8{r8b},Imm8{0x0f});          assert(shouldBe("4180080f"));
  a.or_(M8{r8b},r8b);                 assert(shouldBe("450800"));
  a.or_(r8w,Imm16{0xffff});           assert(shouldBe("664181c8ffff"));
  a.or_(r8w,Imm8{0x0f});              assert(shouldBe("664183c80f"));
  a.or_(r8w,M16{r8w});                assert(shouldBe("66450b00"));
  a.or_(r8w,r8w);                     assert(shouldBe("664509c0"));
  a.or_(r8d,Imm32{0xffffffff});       assert(shouldBe("4181c8ffffffff"));
  a.or_(r8d,Imm8{0x0f});              assert(shouldBe("4183c80f"));
  a.or_(r8d,M32{r8d});                assert(shouldBe("67450b00"));
  a.or_(r8d,r8d);                     assert(shouldBe("4509c0"));
  a.or_(r8,Imm32{0xffffffff});        assert(shouldBe("4981c8ffffffff"));
  a.or_(r8,Imm8{0x0f});               assert(shouldBe("4983c80f"));
  a.or_(r8,M64{r8});                  assert(shouldBe("4d0b00"));
  a.or_(r8,r8);                       assert(shouldBe("4d09c0"));
  a.or_(r8b,Imm8{0x0f});              assert(shouldBe("4180c80f"));
  a.or_(r8b,M8{r8b});                 assert(shouldBe("450a00"));
  a.or_(rax,Imm32{0xffffffff});       assert(shouldBe("480dffffffff"));
  a.adc(al,Imm8{0x0f});               assert(shouldBe("140f"));
  a.adc(ax,Imm16{0xffff});            assert(shouldBe("6615ffff"));
  a.adc(eax,Imm32{0xffffffff});       assert(shouldBe("15ffffffff"));
  a.adc(M16{r8w},Imm16{0xffff});      assert(shouldBe("66418110ffff"));
  a.adc(M16{r8w},Imm8{0x0f});         assert(shouldBe("664183100f"));
  a.adc(M16{r8w},r8w);                assert(shouldBe("66451100"));
  a.adc(M32{r8d},Imm32{0xffffffff});  assert(shouldBe("67418110ffffffff"));
  a.adc(M32{r8d},Imm8{0x0f});         assert(shouldBe("674183100f"));
  a.adc(M32{r8d},r8d);                assert(shouldBe("67451100"));
  a.adc(M64{r8},Imm32{0xffffffff});   assert(shouldBe("498110ffffffff"));
  a.adc(M64{r8},Imm8{0x0f});          assert(shouldBe("4983100f"));
  a.adc(M64{r8},r8);                  assert(shouldBe("4d1100"));
  a.adc(M8{r8b},Imm8{0x0f});          assert(shouldBe("4180100f"));
  a.adc(M8{r8b},r8b);                 assert(shouldBe("451000"));
  a.adc(r8w,Imm16{0xffff});           assert(shouldBe("664181d0ffff"));
  a.adc(r8w,Imm8{0x0f});              assert(shouldBe("664183d00f"));
  a.adc(r8w,M16{r8w});                assert(shouldBe("66451300"));
  a.adc(r8w,r8w);                     assert(shouldBe("664511c0"));
  a.adc(r8d,Imm32{0xffffffff});       assert(shouldBe("4181d0ffffffff"));
  a.adc(r8d,Imm8{0x0f});              assert(shouldBe("4183d00f"));
  a.adc(r8d,M32{r8d});                assert(shouldBe("67451300"));
  a.adc(r8d,r8d);                     assert(shouldBe("4511c0"));
  a.adc(r8,Imm32{0xffffffff});        assert(shouldBe("4981d0ffffffff"));
  a.adc(r8,Imm8{0x0f});               assert(shouldBe("4983d00f"));
  a.adc(r8,M64{r8});                  assert(shouldBe("4d1300"));
  a.adc(r8,r8);                       assert(shouldBe("4d11c0"));
  a.adc(r8b,Imm8{0x0f});              assert(shouldBe("4180d00f"));
  a.adc(r8b,M8{r8b});                 assert(shouldBe("451200"));
  a.adc(rax,Imm32{0xffffffff});       assert(shouldBe("4815ffffffff"));
  a.sbb(al,Imm8{0x0f});               assert(shouldBe("1c0f"));
  a.sbb(ax,Imm16{0xffff});            assert(shouldBe("661dffff"));
  a.sbb(eax,Imm32{0xffffffff});       assert(shouldBe("1dffffffff"));
  a.sbb(M16{r8w},Imm16{0xffff});      assert(shouldBe("66418118ffff"));
  a.sbb(M16{r8w},Imm8{0x0f});         assert(shouldBe("664183180f"));
  a.sbb(M16{r8w},r8w);                assert(shouldBe("66451900"));
  a.sbb(M32{r8d},Imm32{0xffffffff});  assert(shouldBe("67418118ffffffff"));
  a.sbb(M32{r8d},Imm8{0x0f});         assert(shouldBe("674183180f"));
  a.sbb(M32{r8d},r8d);                assert(shouldBe("67451900"));
  a.sbb(M64{r8},Imm32{0xffffffff});   assert(shouldBe("498118ffffffff"));
  a.sbb(M64{r8},Imm8{0x0f});          assert(shouldBe("4983180f"));
  a.sbb(M64{r8},r8);                  assert(shouldBe("4d1900"));
  a.sbb(M8{r8b},Imm8{0x0f});          assert(shouldBe("4180180f"));
  a.sbb(M8{r8b},r8b);                 assert(shouldBe("451800"));
  a.sbb(r8w,Imm16{0xffff});           assert(shouldBe("664181d8ffff"));
  a.sbb(r8w,Imm8{0x0f});              assert(shouldBe("664183d80f"));
  a.sbb(r8w,M16{r8w});                assert(shouldBe("66451b00"));
  a.sbb(r8w,r8w);                     assert(shouldBe("664519c0"));
  a.sbb(r8d,Imm32{0xffffffff});       assert(shouldBe("4181d8ffffffff"));
  a.sbb(r8d,Imm8{0x0f});              assert(shouldBe("4183d80f"));
  a.sbb(r8d,M32{r8d});                assert(shouldBe("67451b00"));
  a.sbb(r8d,r8d);                     assert(shouldBe("4519c0"));
  a.sbb(r8,Imm32{0xffffffff});        assert(shouldBe("4981d8ffffffff"));
  a.sbb(r8,Imm8{0x0f});               assert(shouldBe("4983d80f"));
  a.sbb(r8,M64{r8});                  assert(shouldBe("4d1b00"));
  a.sbb(r8,r8);                       assert(shouldBe("4d19c0"));
  a.sbb(r8b,Imm8{0x0f});              assert(shouldBe("4180d80f"));
  a.sbb(r8b,M8{r8b});                 assert(shouldBe("451a00"));
  a.sbb(rax,Imm32{0xffffffff});       assert(shouldBe("481dffffffff"));
  a.and_(al,Imm8{0x0f});              assert(shouldBe("240f"));
  a.and_(ax,Imm16{0xffff});           assert(shouldBe("6625ffff"));
  a.and_(eax,Imm32{0xffffffff});      assert(shouldBe("25ffffffff"));
  a.and_(M16{r8w},Imm16{0xffff});     assert(shouldBe("66418120ffff"));
  a.and_(M16{r8w},Imm8{0x0f});        assert(shouldBe("664183200f"));
  a.and_(M16{r8w},r8w);               assert(shouldBe("66452100"));
  a.and_(M32{r8d},Imm32{0xffffffff}); assert(shouldBe("67418120ffffffff"));
  a.and_(M32{r8d},Imm8{0x0f});        assert(shouldBe("674183200f"));
  a.and_(M32{r8d},r8d);               assert(shouldBe("67452100"));
  a.and_(M64{r8},Imm32{0xffffffff});  assert(shouldBe("498120ffffffff"));
  a.and_(M64{r8},Imm8{0x0f});         assert(shouldBe("4983200f"));
  a.and_(M64{r8},r8);                 assert(shouldBe("4d2100"));
  a.and_(M8{r8b},Imm8{0x0f});         assert(shouldBe("4180200f"));
  a.and_(M8{r8b},r8b);                assert(shouldBe("452000"));
  a.and_(r8w,Imm16{0xffff});          assert(shouldBe("664181e0ffff"));
  a.and_(r8w,Imm8{0x0f});             assert(shouldBe("664183e00f"));
  a.and_(r8w,M16{r8w});               assert(shouldBe("66452300"));
  a.and_(r8w,r8w);                    assert(shouldBe("664521c0"));
  a.and_(r8d,Imm32{0xffffffff});      assert(shouldBe("4181e0ffffffff"));
  a.and_(r8d,Imm8{0x0f});             assert(shouldBe("4183e00f"));
  a.and_(r8d,M32{r8d});               assert(shouldBe("67452300"));
  a.and_(r8d,r8d);                    assert(shouldBe("4521c0"));
  a.and_(r8,Imm32{0xffffffff});       assert(shouldBe("4981e0ffffffff"));
  a.and_(r8,Imm8{0x0f});              assert(shouldBe("4983e00f"));
  a.and_(r8,M64{r8});                 assert(shouldBe("4d2300"));
  a.and_(r8,r8);                      assert(shouldBe("4d21c0"));
  a.and_(r8b,Imm8{0x0f});             assert(shouldBe("4180e00f"));
  a.and_(r8b,M8{r8b});                assert(shouldBe("452200"));
  a.and_(rax,Imm32{0xffffffff});      assert(shouldBe("4825ffffffff"));
  a.sub(al,Imm8{0x0f});               assert(shouldBe("2c0f"));
  a.sub(ax,Imm16{0xffff});            assert(shouldBe("662dffff"));
  a.sub(eax,Imm32{0xffffffff});       assert(shouldBe("2dffffffff"));
  a.sub(M16{r8w},Imm16{0xffff});      assert(shouldBe("66418128ffff"));
  a.sub(M16{r8w},Imm8{0x0f});         assert(shouldBe("664183280f"));
  a.sub(M16{r8w},r8w);                assert(shouldBe("66452900"));
  a.sub(M32{r8d},Imm32{0xffffffff});  assert(shouldBe("67418128ffffffff"));
  a.sub(M32{r8d},Imm8{0x0f});         assert(shouldBe("674183280f"));
  a.sub(M32{r8d},r8d);                assert(shouldBe("67452900"));
  a.sub(M64{r8},Imm32{0xffffffff});   assert(shouldBe("498128ffffffff"));
  a.sub(M64{r8},Imm8{0x0f});          assert(shouldBe("4983280f"));
  a.sub(M64{r8},r8);                  assert(shouldBe("4d2900"));
  a.sub(M8{r8b},Imm8{0x0f});          assert(shouldBe("4180280f"));
  a.sub(M8{r8b},r8b);                 assert(shouldBe("452800"));
  a.sub(r8w,Imm16{0xffff});           assert(shouldBe("664181e8ffff"));
  a.sub(r8w,Imm8{0x0f});              assert(shouldBe("664183e80f"));
  a.sub(r8w,M16{r8w});                assert(shouldBe("66452b00"));
  a.sub(r8w,r8w);                     assert(shouldBe("664529c0"));
  a.sub(r8d,Imm32{0xffffffff});       assert(shouldBe("4181e8ffffffff"));
  a.sub(r8d,Imm8{0x0f});              assert(shouldBe("4183e80f"));
  a.sub(r8d,M32{r8d});                assert(shouldBe("67452b00"));
  a.sub(r8d,r8d);                     assert(shouldBe("4529c0"));
  a.sub(r8,Imm32{0xffffffff});        assert(shouldBe("4981e8ffffffff"));
  a.sub(r8,Imm8{0x0f});               assert(shouldBe("4983e80f"));
  a.sub(r8,M64{r8});                  assert(shouldBe("4d2b00"));
  a.sub(r8,r8);                       assert(shouldBe("4d29c0"));
  a.sub(r8b,Imm8{0x0f});              assert(shouldBe("4180e80f"));
  a.sub(r8b,M8{r8b});                 assert(shouldBe("452a00"));
  a.sub(rax,Imm32{0xffffffff});       assert(shouldBe("482dffffffff"));
  a.xor_(al,Imm8{0x0f});              assert(shouldBe("340f"));
  a.xor_(ax,Imm16{0xffff});           assert(shouldBe("6635ffff"));
  a.xor_(eax,Imm32{0xffffffff});      assert(shouldBe("35ffffffff"));
  a.xor_(M16{r8w},Imm16{0xffff});     assert(shouldBe("66418130ffff"));
  a.xor_(M16{r8w},Imm8{0x0f});        assert(shouldBe("664183300f"));
  a.xor_(M16{r8w},r8w);               assert(shouldBe("66453100"));
  a.xor_(M32{r8d},Imm32{0xffffffff}); assert(shouldBe("67418130ffffffff"));
  a.xor_(M32{r8d},Imm8{0x0f});        assert(shouldBe("674183300f"));
  a.xor_(M32{r8d},r8d);               assert(shouldBe("67453100"));
  a.xor_(M64{r8},Imm32{0xffffffff});  assert(shouldBe("498130ffffffff"));
  a.xor_(M64{r8},Imm8{0x0f});         assert(shouldBe("4983300f"));
  a.xor_(M64{r8},r8);                 assert(shouldBe("4d3100"));
  a.xor_(M8{r8b},Imm8{0x0f});         assert(shouldBe("4180300f"));
  a.xor_(M8{r8b},r8b);                assert(shouldBe("453000"));
  a.xor_(r8w,Imm16{0xffff});          assert(shouldBe("664181f0ffff"));
  a.xor_(r8w,Imm8{0x0f});             assert(shouldBe("664183f00f"));
  a.xor_(r8w,M16{r8w});               assert(shouldBe("66453300"));
  a.xor_(r8w,r8w);                    assert(shouldBe("664531c0"));
  a.xor_(r8d,Imm32{0xffffffff});      assert(shouldBe("4181f0ffffffff"));
  a.xor_(r8d,Imm8{0x0f});             assert(shouldBe("4183f00f"));
  a.xor_(r8d,M32{r8d});               assert(shouldBe("67453300"));
  a.xor_(r8d,r8d);                    assert(shouldBe("4531c0"));
  a.xor_(r8,Imm32{0xffffffff});       assert(shouldBe("4981f0ffffffff"));
  a.xor_(r8,Imm8{0x0f});              assert(shouldBe("4983f00f"));
  a.xor_(r8,M64{r8});                 assert(shouldBe("4d3300"));
  a.xor_(r8,r8);                      assert(shouldBe("4d31c0"));
  a.xor_(r8b,Imm8{0x0f});             assert(shouldBe("4180f00f"));
  a.xor_(r8b,M8{r8b});                assert(shouldBe("453200"));
  a.xor_(rax,Imm32{0xffffffff});      assert(shouldBe("4835ffffffff"));
  a.cmp(al,Imm8{0x0f});               assert(shouldBe("3c0f"));
  a.cmp(ax,Imm16{0xffff});            assert(shouldBe("663dffff"));
  a.cmp(eax,Imm32{0xffffffff});       assert(shouldBe("3dffffffff"));
  a.cmp(M16{r8w},Imm16{0xffff});      assert(shouldBe("66418138ffff"));
  a.cmp(M16{r8w},Imm8{0x0f});         assert(shouldBe("664183380f"));
  a.cmp(M16{r8w},r8w);                assert(shouldBe("66453900"));
  a.cmp(M32{r8d},Imm32{0xffffffff});  assert(shouldBe("67418138ffffffff"));
  a.cmp(M32{r8d},Imm8{0x0f});         assert(shouldBe("674183380f"));
  a.cmp(M32{r8d},r8d);                assert(shouldBe("67453900"));
  a.cmp(M64{r8},Imm32{0xffffffff});   assert(shouldBe("498138ffffffff"));
  a.cmp(M64{r8},Imm8{0x0f});          assert(shouldBe("4983380f"));
  a.cmp(M64{r8},r8);                  assert(shouldBe("4d3900"));
  a.cmp(M8{r8b},Imm8{0x0f});          assert(shouldBe("4180380f"));
  a.cmp(M8{r8b},r8b);                 assert(shouldBe("453800"));
  a.cmp(r8w,Imm16{0xffff});           assert(shouldBe("664181f8ffff"));
  a.cmp(r8w,Imm8{0x0f});              assert(shouldBe("664183f80f"));
  a.cmp(r8w,M16{r8w});                assert(shouldBe("66453b00"));
  a.cmp(r8w,r8w);                     assert(shouldBe("664539c0"));
  a.cmp(r8d,Imm32{0xffffffff});       assert(shouldBe("4181f8ffffffff"));
  a.cmp(r8d,Imm8{0x0f});              assert(shouldBe("4183f80f"));
  a.cmp(r8d,M32{r8d});                assert(shouldBe("67453b00"));
  a.cmp(r8d,r8d);                     assert(shouldBe("4539c0"));
  a.cmp(r8,Imm32{0xffffffff});        assert(shouldBe("4981f8ffffffff"));
  a.cmp(r8,Imm8{0x0f});               assert(shouldBe("4983f80f"));
  a.cmp(r8,M64{r8});                  assert(shouldBe("4d3b00"));
  a.cmp(r8,r8);                       assert(shouldBe("4d39c0"));
  a.cmp(r8b,Imm8{0x0f});              assert(shouldBe("4180f80f"));
  a.cmp(r8b,M8{r8b});                 assert(shouldBe("453a00"));
  a.cmp(rax,Imm32{0xffffffff});       assert(shouldBe("483dffffffff"));
  a.test(al,Imm8{0x0f});              assert(shouldBe("a80f"));
  a.test(ax,Imm16{0xffff});           assert(shouldBe("66a9ffff"));
  a.test(eax,Imm32{0xffffffff});      assert(shouldBe("a9ffffffff"));
  a.test(M16{r8w},Imm16{0xffff});     assert(shouldBe("6641f700ffff"));
  a.test(M16{r8w},r8w);               assert(shouldBe("66458500"));
  a.test(M32{r8d},Imm32{0xffffffff}); assert(shouldBe("6741f700ffffffff"));
  a.test(M32{r8d},r8d);               assert(shouldBe("67458500"));
  a.test(M64{r8},Imm32{0xffffffff});  assert(shouldBe("49f700ffffffff"));
  a.test(M64{r8},r8);                 assert(shouldBe("4d8500"));
  a.test(M8{r8b},Imm8{0x0f});         assert(shouldBe("41f6000f"));
  a.test(M8{r8b},r8b);                assert(shouldBe("458400"));
  a.test(r8w,Imm16{0xffff});          assert(shouldBe("6641f7c0ffff"));
  a.test(r8w,r8w);                    assert(shouldBe("664585c0"));
  a.test(r8d,Imm32{0xffffffff});      assert(shouldBe("41f7c0ffffffff"));
  a.test(r8d,r8d);                    assert(shouldBe("4585c0"));
  a.test(r8,Imm32{0xffffffff});       assert(shouldBe("49f7c0ffffffff"));
  a.test(r8,r8);                      assert(shouldBe("4d85c0"));
  a.test(r8b,Imm8{0x0f});             assert(shouldBe("41f6c00f"));
  a.test(rax,Imm32{0xffffffff});      assert(shouldBe("48a9ffffffff"));
  a.mov(M16{r8w},Imm16{0xffff});      assert(shouldBe("6641c700ffff"));
  a.mov(M16{r8w},r8w);                assert(shouldBe("66458900"));
  a.mov(M32{r8d},Imm32{0xffffffff});  assert(shouldBe("6741c700ffffffff"));
  a.mov(M32{r8d},r8d);                assert(shouldBe("67458900"));
  a.mov(M64{r8},Imm32{0xffffffff});   assert(shouldBe("49c700ffffffff"));
  a.mov(M64{r8},r8);                  assert(shouldBe("4d8900"));
  a.mov(M8{r8b},Imm8{0x0f});          assert(shouldBe("41c6000f"));
  a.mov(M8{r8b},r8b);                 assert(shouldBe("458800"));
  a.mov(r8w,Imm16{0xffff});           assert(shouldBe("6641b8ffff"));
  a.mov(r8w,M16{r8w});                assert(shouldBe("66458b00"));
  a.mov(r8w,r8w);                     assert(shouldBe("664589c0"));
  a.mov(r8d,Imm32{0xffffffff});       assert(shouldBe("41b8ffffffff"));
  a.mov(r8d,M32{r8d});                assert(shouldBe("67458b00"));
  a.mov(r8d,r8d);                     assert(shouldBe("4589c0"));
  // a.mov(r8,Imm32{0xffffffff});        assert(shouldBe("41b8ffffffff"));
  a.mov(r8,Imm64{0xfffffffff});       assert(shouldBe("49b8ffffffff0f000000"));
  a.mov(r8,M64{r8});                  assert(shouldBe("4d8b00"));
  a.mov(r8,r8);                       assert(shouldBe("4d89c0"));
  a.mov(r8b,Imm8{0x0f});              assert(shouldBe("41b00f"));
  a.mov(r8b,M8{r8b});                 assert(shouldBe("458a00"));
  a.rol(M16{r8w},cl);                 assert(shouldBe("6641d300"));
  a.rol(M16{r8w},Imm8{0x0f});         assert(shouldBe("6641c1000f"));
  a.rol(M16{r8w},One{});                assert(shouldBe("6641d100"));
  a.rol(M32{r8d},cl);                 assert(shouldBe("6741d300"));
  a.rol(M32{r8d},Imm8{0x0f});         assert(shouldBe("6741c1000f"));
  a.rol(M32{r8d},One{});                assert(shouldBe("6741d100"));
  a.rol(M64{r8},cl);                  assert(shouldBe("49d300"));
  a.rol(M64{r8},Imm8{0x0f});          assert(shouldBe("49c1000f"));
  a.rol(M64{r8},One{});                 assert(shouldBe("49d100"));
  a.rol(M8{r8b},cl);                  assert(shouldBe("41d200"));
  a.rol(M8{r8b},Imm8{0x0f});          assert(shouldBe("41c0000f"));
  a.rol(M8{r8b},One{});                 assert(shouldBe("41d000"));
  a.rol(r8w,cl);                      assert(shouldBe("6641d3c0"));
  a.rol(r8w,Imm8{0x0f});              assert(shouldBe("6641c1c00f"));
  a.rol(r8w,One{});                     assert(shouldBe("6641d1c0"));
  a.rol(r8d,cl);                      assert(shouldBe("41d3c0"));
  a.rol(r8d,Imm8{0x0f});              assert(shouldBe("41c1c00f"));
  a.rol(r8d,One{});                     assert(shouldBe("41d1c0"));
  a.rol(r8,cl);                       assert(shouldBe("49d3c0"));
  a.rol(r8,Imm8{0x0f});               assert(shouldBe("49c1c00f"));
  a.rol(r8,One{});                      assert(shouldBe("49d1c0"));
  a.rol(r8b,cl);                      assert(shouldBe("41d2c0"));
  a.rol(r8b,Imm8{0x0f});              assert(shouldBe("41c0c00f"));
  a.rol(r8b,One{});                     assert(shouldBe("41d0c0"));
  a.ror(M16{r8w},cl);                 assert(shouldBe("6641d308"));
  a.ror(M16{r8w},Imm8{0x0f});         assert(shouldBe("6641c1080f"));
  a.ror(M16{r8w},One{});                assert(shouldBe("6641d108"));
  a.ror(M32{r8d},cl);                 assert(shouldBe("6741d308"));
  a.ror(M32{r8d},Imm8{0x0f});         assert(shouldBe("6741c1080f"));
  a.ror(M32{r8d},One{});                assert(shouldBe("6741d108"));
  a.ror(M64{r8},cl);                  assert(shouldBe("49d308"));
  a.ror(M64{r8},Imm8{0x0f});          assert(shouldBe("49c1080f"));
  a.ror(M64{r8},One{});                 assert(shouldBe("49d108"));
  a.ror(M8{r8b},cl);                  assert(shouldBe("41d208"));
  a.ror(M8{r8b},Imm8{0x0f});          assert(shouldBe("41c0080f"));
  a.ror(M8{r8b},One{});                 assert(shouldBe("41d008"));
  a.ror(r8w,cl);                      assert(shouldBe("6641d3c8"));
  a.ror(r8w,Imm8{0x0f});              assert(shouldBe("6641c1c80f"));
  a.ror(r8w,One{});                     assert(shouldBe("6641d1c8"));
  a.ror(r8d,cl);                      assert(shouldBe("41d3c8"));
  a.ror(r8d,Imm8{0x0f});              assert(shouldBe("41c1c80f"));
  a.ror(r8d,One{});                     assert(shouldBe("41d1c8"));
  a.ror(r8,cl);                       assert(shouldBe("49d3c8"));
  a.ror(r8,Imm8{0x0f});               assert(shouldBe("49c1c80f"));
  a.ror(r8,One{});                      assert(shouldBe("49d1c8"));
  a.ror(r8b,cl);                      assert(shouldBe("41d2c8"));
  a.ror(r8b,Imm8{0x0f});              assert(shouldBe("41c0c80f"));
  a.ror(r8b,One{});                     assert(shouldBe("41d0c8"));
  a.rcl(M16{r8w},cl);                 assert(shouldBe("6641d310"));
  a.rcl(M16{r8w},Imm8{0x0f});         assert(shouldBe("6641c1100f"));
  a.rcl(M16{r8w},One{});                assert(shouldBe("6641d110"));
  a.rcl(M32{r8d},cl);                 assert(shouldBe("6741d310"));
  a.rcl(M32{r8d},Imm8{0x0f});         assert(shouldBe("6741c1100f"));
  a.rcl(M32{r8d},One{});                assert(shouldBe("6741d110"));
  a.rcl(M64{r8},cl);                  assert(shouldBe("49d310"));
  a.rcl(M64{r8},Imm8{0x0f});          assert(shouldBe("49c1100f"));
  a.rcl(M64{r8},One{});                 assert(shouldBe("49d110"));
  a.rcl(M8{r8b},cl);                  assert(shouldBe("41d210"));
  a.rcl(M8{r8b},Imm8{0x0f});          assert(shouldBe("41c0100f"));
  a.rcl(M8{r8b},One{});                 assert(shouldBe("41d010"));
  a.rcl(r8w,cl);                      assert(shouldBe("6641d3d0"));
  a.rcl(r8w,Imm8{0x0f});              assert(shouldBe("6641c1d00f"));
  a.rcl(r8w,One{});                     assert(shouldBe("6641d1d0"));
  a.rcl(r8d,cl);                      assert(shouldBe("41d3d0"));
  a.rcl(r8d,Imm8{0x0f});              assert(shouldBe("41c1d00f"));
  a.rcl(r8d,One{});                     assert(shouldBe("41d1d0"));
  a.rcl(r8,cl);                       assert(shouldBe("49d3d0"));
  a.rcl(r8,Imm8{0x0f});               assert(shouldBe("49c1d00f"));
  a.rcl(r8,One{});                      assert(shouldBe("49d1d0"));
  a.rcl(r8b,cl);                      assert(shouldBe("41d2d0"));
  a.rcl(r8b,Imm8{0x0f});              assert(shouldBe("41c0d00f"));
  a.rcl(r8b,One{});                     assert(shouldBe("41d0d0"));
  a.rcr(M16{r8w},cl);                 assert(shouldBe("6641d318"));
  a.rcr(M16{r8w},Imm8{0x0f});         assert(shouldBe("6641c1180f"));
  a.rcr(M16{r8w},One{});                assert(shouldBe("6641d118"));
  a.rcr(M32{r8d},cl);                 assert(shouldBe("6741d318"));
  a.rcr(M32{r8d},Imm8{0x0f});         assert(shouldBe("6741c1180f"));
  a.rcr(M32{r8d},One{});                assert(shouldBe("6741d118"));
  a.rcr(M64{r8},cl);                  assert(shouldBe("49d318"));
  a.rcr(M64{r8},Imm8{0x0f});          assert(shouldBe("49c1180f"));
  a.rcr(M64{r8},One{});                 assert(shouldBe("49d118"));
  a.rcr(M8{r8b},cl);                  assert(shouldBe("41d218"));
  a.rcr(M8{r8b},Imm8{0x0f});          assert(shouldBe("41c0180f"));
  a.rcr(M8{r8b},One{});                 assert(shouldBe("41d018"));
  a.rcr(r8w,cl);                      assert(shouldBe("6641d3d8"));
  a.rcr(r8w,Imm8{0x0f});              assert(shouldBe("6641c1d80f"));
  a.rcr(r8w,One{});                     assert(shouldBe("6641d1d8"));
  a.rcr(r8d,cl);                      assert(shouldBe("41d3d8"));
  a.rcr(r8d,Imm8{0x0f});              assert(shouldBe("41c1d80f"));
  a.rcr(r8d,One{});                     assert(shouldBe("41d1d8"));
  a.rcr(r8,cl);                       assert(shouldBe("49d3d8"));
  a.rcr(r8,Imm8{0x0f});               assert(shouldBe("49c1d80f"));
  a.rcr(r8,One{});                      assert(shouldBe("49d1d8"));
  a.rcr(r8b,cl);                      assert(shouldBe("41d2d8"));
  a.rcr(r8b,Imm8{0x0f});              assert(shouldBe("41c0d80f"));
  a.rcr(r8b,One{});                     assert(shouldBe("41d0d8"));
  a.shl(M16{r8w},cl);                 assert(shouldBe("6641d320"));
  a.shl(M16{r8w},Imm8{0x0f});         assert(shouldBe("6641c1200f"));
  a.shl(M16{r8w},One{});                assert(shouldBe("6641d120"));
  a.shl(M32{r8d},cl);                 assert(shouldBe("6741d320"));
  a.shl(M32{r8d},Imm8{0x0f});         assert(shouldBe("6741c1200f"));
  a.shl(M32{r8d},One{});                assert(shouldBe("6741d120"));
  a.shl(M64{r8},cl);                  assert(shouldBe("49d320"));
  a.shl(M64{r8},Imm8{0x0f});          assert(shouldBe("49c1200f"));
  a.shl(M64{r8},One{});                 assert(shouldBe("49d120"));
  a.shl(M8{r8b},cl);                  assert(shouldBe("41d220"));
  a.shl(M8{r8b},Imm8{0x0f});          assert(shouldBe("41c0200f"));
  a.shl(M8{r8b},One{});                 assert(shouldBe("41d020"));
  a.shl(r8w,cl);                      assert(shouldBe("6641d3e0"));
  a.shl(r8w,Imm8{0x0f});              assert(shouldBe("6641c1e00f"));
  a.shl(r8w,One{});                     assert(shouldBe("6641d1e0"));
  a.shl(r8d,cl);                      assert(shouldBe("41d3e0"));
  a.shl(r8d,Imm8{0x0f});              assert(shouldBe("41c1e00f"));
  a.shl(r8d,One{});                     assert(shouldBe("41d1e0"));
  a.shl(r8,cl);                       assert(shouldBe("49d3e0"));
  a.shl(r8,Imm8{0x0f});               assert(shouldBe("49c1e00f"));
  a.shl(r8,One{});                      assert(shouldBe("49d1e0"));
  a.shl(r8b,cl);                      assert(shouldBe("41d2e0"));
  a.shl(r8b,Imm8{0x0f});              assert(shouldBe("41c0e00f"));
  a.shl(r8b,One{});                     assert(shouldBe("41d0e0"));
  a.shr(M16{r8w},cl);                 assert(shouldBe("6641d328"));
  a.shr(M16{r8w},Imm8{0x0f});         assert(shouldBe("6641c1280f"));
  a.shr(M16{r8w},One{});                assert(shouldBe("6641d128"));
  a.shr(M32{r8d},cl);                 assert(shouldBe("6741d328"));
  a.shr(M32{r8d},Imm8{0x0f});         assert(shouldBe("6741c1280f"));
  a.shr(M32{r8d},One{});                assert(shouldBe("6741d128"));
  a.shr(M64{r8},cl);                  assert(shouldBe("49d328"));
  a.shr(M64{r8},Imm8{0x0f});          assert(shouldBe("49c1280f"));
  a.shr(M64{r8},One{});                 assert(shouldBe("49d128"));
  a.shr(M8{r8b},cl);                  assert(shouldBe("41d228"));
  a.shr(M8{r8b},Imm8{0x0f});          assert(shouldBe("41c0280f"));
  a.shr(M8{r8b},One{});                 assert(shouldBe("41d028"));
  a.shr(r8w,cl);                      assert(shouldBe("6641d3e8"));
  a.shr(r8w,Imm8{0x0f});              assert(shouldBe("6641c1e80f"));
  a.shr(r8w,One{});                     assert(shouldBe("6641d1e8"));
  a.shr(r8d,cl);                      assert(shouldBe("41d3e8"));
  a.shr(r8d,Imm8{0x0f});              assert(shouldBe("41c1e80f"));
  a.shr(r8d,One{});                     assert(shouldBe("41d1e8"));
  a.shr(r8,cl);                       assert(shouldBe("49d3e8"));
  a.shr(r8,Imm8{0x0f});               assert(shouldBe("49c1e80f"));
  a.shr(r8,One{});                      assert(shouldBe("49d1e8"));
  a.shr(r8b,cl);                      assert(shouldBe("41d2e8"));
  a.shr(r8b,Imm8{0x0f});              assert(shouldBe("41c0e80f"));
  a.shr(r8b,One{});                     assert(shouldBe("41d0e8"));
  a.sar(M16{r8w},cl);                 assert(shouldBe("6641d338"));
  a.sar(M16{r8w},Imm8{0x0f});         assert(shouldBe("6641c1380f"));
  a.sar(M16{r8w},One{});                assert(shouldBe("6641d138"));
  a.sar(M32{r8d},cl);                 assert(shouldBe("6741d338"));
  a.sar(M32{r8d},Imm8{0x0f});         assert(shouldBe("6741c1380f"));
  a.sar(M32{r8d},One{});                assert(shouldBe("6741d138"));
  a.sar(M64{r8},cl);                  assert(shouldBe("49d338"));
  a.sar(M64{r8},Imm8{0x0f});          assert(shouldBe("49c1380f"));
  a.sar(M64{r8},One{});                 assert(shouldBe("49d138"));
  a.sar(M8{r8b},cl);                  assert(shouldBe("41d238"));
  a.sar(M8{r8b},Imm8{0x0f});          assert(shouldBe("41c0380f"));
  a.sar(M8{r8b},One{});                 assert(shouldBe("41d038"));
  a.sar(r8w,cl);                      assert(shouldBe("6641d3f8"));
  a.sar(r8w,Imm8{0x0f});              assert(shouldBe("6641c1f80f"));
  a.sar(r8w,One{});                     assert(shouldBe("6641d1f8"));
  a.sar(r8d,cl);                      assert(shouldBe("41d3f8"));
  a.sar(r8d,Imm8{0x0f});              assert(shouldBe("41c1f80f"));
  a.sar(r8d,One{});                     assert(shouldBe("41d1f8"));
  a.sar(r8,cl);                       assert(shouldBe("49d3f8"));
  a.sar(r8,Imm8{0x0f});               assert(shouldBe("49c1f80f"));
  a.sar(r8,One{});                      assert(shouldBe("49d1f8"));
  a.sar(r8b,cl);                      assert(shouldBe("41d2f8"));
  a.sar(r8b,Imm8{0x0f});              assert(shouldBe("41c0f80f"));
  a.sar(r8b,One{});                     assert(shouldBe("41d0f8"));
  a.xchg(ax,r8w);                     assert(shouldBe("664190"));
  a.xchg(eax,r8d);                    assert(shouldBe("4190"));
  a.xchg(M16{r8w},r8w);               assert(shouldBe("66458700"));
  a.xchg(M32{r8d},r8d);               assert(shouldBe("67458700"));
  a.xchg(M64{r8},r8);                 assert(shouldBe("4d8700"));
  a.xchg(M8{r8b},r8b);                assert(shouldBe("458600"));
  a.xchg(r8w,ax);                     assert(shouldBe("664190"));
  a.xchg(r8w,r8w);                    assert(shouldBe("664587c0"));
  a.xchg(r8d,eax);                    assert(shouldBe("4190"));
  a.xchg(r8d,r8d);                    assert(shouldBe("4587c0"));
  a.xchg(r8,r8);                      assert(shouldBe("4d87c0"));
  a.xchg(r8,rax);                     assert(shouldBe("4990"));
  a.xchg(rax,r8);                   assert(shouldBe("4990"));
  a.movd(M32{r8d},xmm0);              assert(shouldBe("6766410f7e00"));
  a.movd(r8d,xmm0);                   assert(shouldBe("66410f7ec0"));
  a.movd(xmm0,M32{r8d});              assert(shouldBe("6766410f6e00"));
  a.movd(xmm0,r8d);                   assert(shouldBe("66410f6ec0"));
  a.movq_1(M64{r8},xmm0);             assert(shouldBe("66410fd600"));
  // a.movq_1(r8,xmm0);                  assert(shouldBe("66410fd6c0"));
  a.movq_1(xmm0,xmm0);                assert(shouldBe("660fd6c0"));
  a.movdqa(M128{xmm0},xmm0);          assert(shouldBe("660f7f00"));
  a.movdqa(xmm0,M128{xmm0});          assert(shouldBe("660f6f00"));
  a.movdqa(xmm0,xmm0);                assert(shouldBe("660f6fc0"));
  a.paddb(xmm0,M128{xmm0});           assert(shouldBe("660ffc00"));
  a.paddb(xmm0,xmm0);                 assert(shouldBe("660ffcc0"));
  a.paddw(xmm0,M128{xmm0});           assert(shouldBe("660ffd00"));
  a.paddw(xmm0,xmm0);                 assert(shouldBe("660ffdc0"));
  a.paddd(xmm0,M128{xmm0});           assert(shouldBe("660ffe00"));
  a.paddd(xmm0,xmm0);                 assert(shouldBe("660ffec0"));
  a.paddq(xmm0,M128{xmm0});           assert(shouldBe("660fd400"));
  a.paddq(xmm0,xmm0);                 assert(shouldBe("660fd4c0"));
  a.psubb(xmm0,M128{xmm0});           assert(shouldBe("660ff800"));
  a.psubb(xmm0,xmm0);                 assert(shouldBe("660ff8c0"));
  a.psubw(xmm0,M128{xmm0});           assert(shouldBe("660ff900"));
  a.psubw(xmm0,xmm0);                 assert(shouldBe("660ff9c0"));
  a.psubd(xmm0,M128{xmm0});           assert(shouldBe("660ffa00"));
  a.psubd(xmm0,xmm0);                 assert(shouldBe("660ffac0"));
  a.psubq(xmm0,M128{xmm0});           assert(shouldBe("660ffb00"));
  a.psubq(xmm0,xmm0);                 assert(shouldBe("660ffbc0"));
  a.pxor(xmm0,M128{xmm0});            assert(shouldBe("660fef00"));
  a.pxor(xmm0,xmm0);                  assert(shouldBe("660fefc0"));
  // a.psllw(xmm0,Imm8{0x0f});           assert(shouldBe("660f71d00f"));
  // a.pslld(xmm0,Imm8{0x0f});           assert(shouldBe("660f72d00f"));
  // a.psllq(xmm0,Imm8{0x0f});           assert(shouldBe("660f73d00f"));
  // a.pslldq(xmm0,Imm8{0x0f});          assert(shouldBe("660f73f80f"));
  // a.psrlw(xmm0,Imm8{0x0f});           assert(shouldBe("660f71f00f"));
  // a.psrld(xmm0,Imm8{0x0f});           assert(shouldBe("660f72f00f"));
  // a.psrlq(xmm0,Imm8{0x0f});           assert(shouldBe("660f73f00f"));
  a.psrldq(xmm0,Imm8{0x0f});          assert(shouldBe("660f73d80f"));
  a.psraw(xmm0,Imm8{0x0f});           assert(shouldBe("660f71e00f"));
  a.psrad(xmm0,Imm8{0x0f});           assert(shouldBe("660f72e00f"));
  a.lea(r8w,M16{r8w});                assert(shouldBe("66458d00"));
  // a.lea(r8w,M32{r8d});              assert(shouldBe("6667458d00"));
  a.lea(r8w,M64{r8});                 assert(shouldBe("66458d00"));
  a.lea(r8d,M16{r8w});                assert(shouldBe("458d00"));
  a.lea(r8d,M32{r8d});                assert(shouldBe("67458d00"));
  a.lea(r8d,M64{r8});                 assert(shouldBe("458d00"));
  a.lea(r8,M16{r8w});                 assert(shouldBe("4d8d00"));
  a.lea(r8,M32{r8d});                 assert(shouldBe("674d8d00"));
  a.lea(r8,M64{r8});                  assert(shouldBe("4d8d00"));
  a.pop(M64{r8});                     assert(shouldBe("418f00"));
  a.pop_1(r8);                        assert(shouldBe("4158"));
  a.push(M64{r8});                    assert(shouldBe("41ff30"));
  a.push_1(r8);                       assert(shouldBe("4150"));
  a.call(M64{r8});                    assert(shouldBe("41ff10"));
  a.call(r8);                         assert(shouldBe("41ffd0"));

  a.ret();                             assert(shouldBe("c3"));
  a.nop();                             assert(shouldBe("90"));
  a.pushfq();                          assert(shouldBe("9c"));
  a.popfq();                           assert(shouldBe("9d"));
  a.cmc();                             assert(shouldBe("f5"));
  a.clc();                             assert(shouldBe("f8"));
  a.stc();                             assert(shouldBe("f9"));
  a.cli();                             assert(shouldBe("fa"));
  a.sti();                             assert(shouldBe("fb"));
  a.cld();                             assert(shouldBe("fc"));
  a.inc(M16{r15w});                    assert(shouldBe("6641ff07"));
  a.inc(M32{r15d});                    assert(shouldBe("6741ff07"));
  a.inc(M64{r15});                     assert(shouldBe("49ff07"));
  a.inc(M8{r15b});                     assert(shouldBe("41fe07"));
  a.inc(r15w);                         assert(shouldBe("6641ffc7"));
  a.inc(r15d);                         assert(shouldBe("41ffc7"));
  a.inc(r15);                          assert(shouldBe("49ffc7"));
  a.inc(r15b);                         assert(shouldBe("41fec7"));
  a.dec(M16{r15w});                    assert(shouldBe("6641ff0f"));
  a.dec(M32{r15d});                    assert(shouldBe("6741ff0f"));
  a.dec(M64{r15});                     assert(shouldBe("49ff0f"));
  a.dec(M8{r15b});                     assert(shouldBe("41fe0f"));
  a.dec(r15w);                         assert(shouldBe("6641ffcf"));
  a.dec(r15d);                         assert(shouldBe("41ffcf"));
  a.dec(r15);                          assert(shouldBe("49ffcf"));
  a.dec(r15b);                         assert(shouldBe("41fecf"));
  a.not_(M16{r15w});                   assert(shouldBe("6641f717"));
  a.not_(M32{r15d});                   assert(shouldBe("6741f717"));
  a.not_(M64{r15});                    assert(shouldBe("49f717"));
  a.not_(M8{r15b});                    assert(shouldBe("41f617"));
  a.not_(r15w);                        assert(shouldBe("6641f7d7"));
  a.not_(r15d);                        assert(shouldBe("41f7d7"));
  a.not_(r15);                         assert(shouldBe("49f7d7"));
  a.not_(r15b);                        assert(shouldBe("41f6d7"));
  a.neg(M16{r15w});                    assert(shouldBe("6641f71f"));
  a.neg(M32{r15d});                    assert(shouldBe("6741f71f"));
  a.neg(M64{r15});                     assert(shouldBe("49f71f"));
  a.neg(M8{r15b});                     assert(shouldBe("41f61f"));
  a.neg(r15w);                         assert(shouldBe("6641f7df"));
  a.neg(r15d);                         assert(shouldBe("41f7df"));
  a.neg(r15);                          assert(shouldBe("49f7df"));
  a.neg(r15b);                         assert(shouldBe("41f6df"));
  a.bswap(r15d);                       assert(shouldBe("410fcf"));
  a.bswap(r15);                        assert(shouldBe("490fcf"));
  a.bsf(r15w,M16{r10w});               assert(shouldBe("66450fbc3a"));
  a.bsf(r15w,r10w);                    assert(shouldBe("66450fbcfa"));
  a.bsf(r15d,M32{r10d});               assert(shouldBe("67450fbc3a"));
  a.bsf(r15d,r10d);                    assert(shouldBe("450fbcfa"));
  a.bsf(r15,M64{r10});                 assert(shouldBe("4d0fbc3a"));
  a.bsf(r15,r10);                      assert(shouldBe("4d0fbcfa"));
  a.bsr(r15w,M16{r10w});               assert(shouldBe("66450fbd3a"));
  a.bsr(r15w,r10w);                    assert(shouldBe("66450fbdfa"));
  a.bsr(r15d,M32{r10d});               assert(shouldBe("67450fbd3a"));
  a.bsr(r15d,r10d);                    assert(shouldBe("450fbdfa"));
  a.bsr(r15,M64{r10});                 assert(shouldBe("4d0fbd3a"));
  a.bsr(r15,r10);                      assert(shouldBe("4d0fbdfa"));
  a.bt(M16{r15w},r10w);                assert(shouldBe("66450fa317"));
  a.bt(M32{r15d},r10d);                assert(shouldBe("67450fa317"));
  a.bt(M64{r15},r10);                  assert(shouldBe("4d0fa317"));
  a.bt(r15w,r10w);                     assert(shouldBe("66450fa3d7"));
  a.bt(r15d,r10d);                     assert(shouldBe("450fa3d7"));
  a.bt(r15,r10);                       assert(shouldBe("4d0fa3d7"));
  a.add(al,Imm8{0x0f});                assert(shouldBe("040f"));
  a.add(ax,Imm16{0xffff});             assert(shouldBe("6605ffff"));
  a.add(eax,Imm32{0xffffffff});        assert(shouldBe("05ffffffff"));
  a.add(M16{r15w},Imm16{0xffff});      assert(shouldBe("66418107ffff"));
  a.add(M16{r15w},Imm8{0x0f});         assert(shouldBe("664183070f"));
  a.add(M16{r15w},r10w);               assert(shouldBe("66450117"));
  a.add(M32{r15d},Imm32{0xffffffff});  assert(shouldBe("67418107ffffffff"));
  a.add(M32{r15d},Imm8{0x0f});         assert(shouldBe("674183070f"));
  a.add(M32{r15d},r10d);               assert(shouldBe("67450117"));
  a.add(M64{r15},Imm32{0xffffffff});   assert(shouldBe("498107ffffffff"));
  a.add(M64{r15},Imm8{0x0f});          assert(shouldBe("4983070f"));
  a.add(M64{r15},r10);                 assert(shouldBe("4d0117"));
  a.add(M8{r15b},Imm8{0x0f});          assert(shouldBe("4180070f"));
  a.add(M8{r15b},r10b);                assert(shouldBe("450017"));
  a.add(r15w,Imm16{0xffff});           assert(shouldBe("664181c7ffff"));
  a.add(r15w,Imm8{0x0f});              assert(shouldBe("664183c70f"));
  a.add(r15w,M16{r10w});               assert(shouldBe("6645033a"));
  a.add(r15w,r10w);                    assert(shouldBe("664501d7"));
  a.add(r15d,Imm32{0xffffffff});       assert(shouldBe("4181c7ffffffff"));
  a.add(r15d,Imm8{0x0f});              assert(shouldBe("4183c70f"));
  a.add(r15d,M32{r10d});               assert(shouldBe("6745033a"));
  a.add(r15d,r10d);                    assert(shouldBe("4501d7"));
  a.add(r15,Imm32{0xffffffff});        assert(shouldBe("4981c7ffffffff"));
  a.add(r15,Imm8{0x0f});               assert(shouldBe("4983c70f"));
  a.add(r15,M64{r10});                 assert(shouldBe("4d033a"));
  a.add(r15,r10);                      assert(shouldBe("4d01d7"));
  a.add(r15b,Imm8{0x0f});              assert(shouldBe("4180c70f"));
  a.add(r15b,M8{r10b});                assert(shouldBe("45023a"));
  a.add(rax,Imm32{0xffffffff});        assert(shouldBe("4805ffffffff"));
  a.or_(al,Imm8{0x0f});                assert(shouldBe("0c0f"));
  a.or_(ax,Imm16{0xffff});             assert(shouldBe("660dffff"));
  a.or_(eax,Imm32{0xffffffff});        assert(shouldBe("0dffffffff"));
  a.or_(M16{r15w},Imm16{0xffff});      assert(shouldBe("6641810fffff"));
  a.or_(M16{r15w},Imm8{0x0f});         assert(shouldBe("6641830f0f"));
  a.or_(M16{r15w},r10w);               assert(shouldBe("66450917"));
  a.or_(M32{r15d},Imm32{0xffffffff});  assert(shouldBe("6741810fffffffff"));
  a.or_(M32{r15d},Imm8{0x0f});         assert(shouldBe("6741830f0f"));
  a.or_(M32{r15d},r10d);               assert(shouldBe("67450917"));
  a.or_(M64{r15},Imm32{0xffffffff});   assert(shouldBe("49810fffffffff"));
  a.or_(M64{r15},Imm8{0x0f});          assert(shouldBe("49830f0f"));
  a.or_(M64{r15},r10);                 assert(shouldBe("4d0917"));
  a.or_(M8{r15b},Imm8{0x0f});          assert(shouldBe("41800f0f"));
  a.or_(M8{r15b},r10b);                assert(shouldBe("450817"));
  a.or_(r15w,Imm16{0xffff});           assert(shouldBe("664181cfffff"));
  a.or_(r15w,Imm8{0x0f});              assert(shouldBe("664183cf0f"));
  a.or_(r15w,M16{r10w});               assert(shouldBe("66450b3a"));
  a.or_(r15w,r10w);                    assert(shouldBe("664509d7"));
  a.or_(r15d,Imm32{0xffffffff});       assert(shouldBe("4181cfffffffff"));
  a.or_(r15d,Imm8{0x0f});              assert(shouldBe("4183cf0f"));
  a.or_(r15d,M32{r10d});               assert(shouldBe("67450b3a"));
  a.or_(r15d,r10d);                    assert(shouldBe("4509d7"));
  a.or_(r15,Imm32{0xffffffff});        assert(shouldBe("4981cfffffffff"));
  a.or_(r15,Imm8{0x0f});               assert(shouldBe("4983cf0f"));
  a.or_(r15,M64{r10});                 assert(shouldBe("4d0b3a"));
  a.or_(r15,r10);                      assert(shouldBe("4d09d7"));
  a.or_(r15b,Imm8{0x0f});              assert(shouldBe("4180cf0f"));
  a.or_(r15b,M8{r10b});                assert(shouldBe("450a3a"));
  a.or_(rax,Imm32{0xffffffff});        assert(shouldBe("480dffffffff"));
  a.adc(al,Imm8{0x0f});                assert(shouldBe("140f"));
  a.adc(ax,Imm16{0xffff});             assert(shouldBe("6615ffff"));
  a.adc(eax,Imm32{0xffffffff});        assert(shouldBe("15ffffffff"));
  a.adc(M16{r15w},Imm16{0xffff});      assert(shouldBe("66418117ffff"));
  a.adc(M16{r15w},Imm8{0x0f});         assert(shouldBe("664183170f"));
  a.adc(M16{r15w},r10w);               assert(shouldBe("66451117"));
  a.adc(M32{r15d},Imm32{0xffffffff});  assert(shouldBe("67418117ffffffff"));
  a.adc(M32{r15d},Imm8{0x0f});         assert(shouldBe("674183170f"));
  a.adc(M32{r15d},r10d);               assert(shouldBe("67451117"));
  a.adc(M64{r15},Imm32{0xffffffff});   assert(shouldBe("498117ffffffff"));
  a.adc(M64{r15},Imm8{0x0f});          assert(shouldBe("4983170f"));
  a.adc(M64{r15},r10);                 assert(shouldBe("4d1117"));
  a.adc(M8{r15b},Imm8{0x0f});          assert(shouldBe("4180170f"));
  a.adc(M8{r15b},r10b);                assert(shouldBe("451017"));
  a.adc(r15w,Imm16{0xffff});           assert(shouldBe("664181d7ffff"));
  a.adc(r15w,Imm8{0x0f});              assert(shouldBe("664183d70f"));
  a.adc(r15w,M16{r10w});               assert(shouldBe("6645133a"));
  a.adc(r15w,r10w);                    assert(shouldBe("664511d7"));
  a.adc(r15d,Imm32{0xffffffff});       assert(shouldBe("4181d7ffffffff"));
  a.adc(r15d,Imm8{0x0f});              assert(shouldBe("4183d70f"));
  a.adc(r15d,M32{r10d});               assert(shouldBe("6745133a"));
  a.adc(r15d,r10d);                    assert(shouldBe("4511d7"));
  a.adc(r15,Imm32{0xffffffff});        assert(shouldBe("4981d7ffffffff"));
  a.adc(r15,Imm8{0x0f});               assert(shouldBe("4983d70f"));
  a.adc(r15,M64{r10});                 assert(shouldBe("4d133a"));
  a.adc(r15,r10);                      assert(shouldBe("4d11d7"));
  a.adc(r15b,Imm8{0x0f});              assert(shouldBe("4180d70f"));
  a.adc(r15b,M8{r10b});                assert(shouldBe("45123a"));
  a.adc(rax,Imm32{0xffffffff});        assert(shouldBe("4815ffffffff"));
  a.sbb(al,Imm8{0x0f});                assert(shouldBe("1c0f"));
  a.sbb(ax,Imm16{0xffff});             assert(shouldBe("661dffff"));
  a.sbb(eax,Imm32{0xffffffff});        assert(shouldBe("1dffffffff"));
  a.sbb(M16{r15w},Imm16{0xffff});      assert(shouldBe("6641811fffff"));
  a.sbb(M16{r15w},Imm8{0x0f});         assert(shouldBe("6641831f0f"));
  a.sbb(M16{r15w},r10w);               assert(shouldBe("66451917"));
  a.sbb(M32{r15d},Imm32{0xffffffff});  assert(shouldBe("6741811fffffffff"));
  a.sbb(M32{r15d},Imm8{0x0f});         assert(shouldBe("6741831f0f"));
  a.sbb(M32{r15d},r10d);               assert(shouldBe("67451917"));
  a.sbb(M64{r15},Imm32{0xffffffff});   assert(shouldBe("49811fffffffff"));
  a.sbb(M64{r15},Imm8{0x0f});          assert(shouldBe("49831f0f"));
  a.sbb(M64{r15},r10);                 assert(shouldBe("4d1917"));
  a.sbb(M8{r15b},Imm8{0x0f});          assert(shouldBe("41801f0f"));
  a.sbb(M8{r15b},r10b);                assert(shouldBe("451817"));
  a.sbb(r15w,Imm16{0xffff});           assert(shouldBe("664181dfffff"));
  a.sbb(r15w,Imm8{0x0f});              assert(shouldBe("664183df0f"));
  a.sbb(r15w,M16{r10w});               assert(shouldBe("66451b3a"));
  a.sbb(r15w,r10w);                    assert(shouldBe("664519d7"));
  a.sbb(r15d,Imm32{0xffffffff});       assert(shouldBe("4181dfffffffff"));
  a.sbb(r15d,Imm8{0x0f});              assert(shouldBe("4183df0f"));
  a.sbb(r15d,M32{r10d});               assert(shouldBe("67451b3a"));
  a.sbb(r15d,r10d);                    assert(shouldBe("4519d7"));
  a.sbb(r15,Imm32{0xffffffff});        assert(shouldBe("4981dfffffffff"));
  a.sbb(r15,Imm8{0x0f});               assert(shouldBe("4983df0f"));
  a.sbb(r15,M64{r10});                 assert(shouldBe("4d1b3a"));
  a.sbb(r15,r10);                      assert(shouldBe("4d19d7"));
  a.sbb(r15b,Imm8{0x0f});              assert(shouldBe("4180df0f"));
  a.sbb(r15b,M8{r10b});                assert(shouldBe("451a3a"));
  a.sbb(rax,Imm32{0xffffffff});        assert(shouldBe("481dffffffff"));
  a.and_(al,Imm8{0x0f});               assert(shouldBe("240f"));
  a.and_(ax,Imm16{0xffff});            assert(shouldBe("6625ffff"));
  a.and_(eax,Imm32{0xffffffff});       assert(shouldBe("25ffffffff"));
  a.and_(M16{r15w},Imm16{0xffff});     assert(shouldBe("66418127ffff"));
  a.and_(M16{r15w},Imm8{0x0f});        assert(shouldBe("664183270f"));
  a.and_(M16{r15w},r10w);              assert(shouldBe("66452117"));
  a.and_(M32{r15d},Imm32{0xffffffff}); assert(shouldBe("67418127ffffffff"));
  a.and_(M32{r15d},Imm8{0x0f});        assert(shouldBe("674183270f"));
  a.and_(M32{r15d},r10d);              assert(shouldBe("67452117"));
  a.and_(M64{r15},Imm32{0xffffffff});  assert(shouldBe("498127ffffffff"));
  a.and_(M64{r15},Imm8{0x0f});         assert(shouldBe("4983270f"));
  a.and_(M64{r15},r10);                assert(shouldBe("4d2117"));
  a.and_(M8{r15b},Imm8{0x0f});         assert(shouldBe("4180270f"));
  a.and_(M8{r15b},r10b);               assert(shouldBe("452017"));
  a.and_(r15w,Imm16{0xffff});          assert(shouldBe("664181e7ffff"));
  a.and_(r15w,Imm8{0x0f});             assert(shouldBe("664183e70f"));
  a.and_(r15w,M16{r10w});              assert(shouldBe("6645233a"));
  a.and_(r15w,r10w);                   assert(shouldBe("664521d7"));
  a.and_(r15d,Imm32{0xffffffff});      assert(shouldBe("4181e7ffffffff"));
  a.and_(r15d,Imm8{0x0f});             assert(shouldBe("4183e70f"));
  a.and_(r15d,M32{r10d});              assert(shouldBe("6745233a"));
  a.and_(r15d,r10d);                   assert(shouldBe("4521d7"));
  a.and_(r15,Imm32{0xffffffff});       assert(shouldBe("4981e7ffffffff"));
  a.and_(r15,Imm8{0x0f});              assert(shouldBe("4983e70f"));
  a.and_(r15,M64{r10});                assert(shouldBe("4d233a"));
  a.and_(r15,r10);                     assert(shouldBe("4d21d7"));
  a.and_(r15b,Imm8{0x0f});             assert(shouldBe("4180e70f"));
  a.and_(r15b,M8{r10b});               assert(shouldBe("45223a"));
  a.and_(rax,Imm32{0xffffffff});       assert(shouldBe("4825ffffffff"));
  a.sub(al,Imm8{0x0f});                assert(shouldBe("2c0f"));
  a.sub(ax,Imm16{0xffff});             assert(shouldBe("662dffff"));
  a.sub(eax,Imm32{0xffffffff});        assert(shouldBe("2dffffffff"));
  a.sub(M16{r15w},Imm16{0xffff});      assert(shouldBe("6641812fffff"));
  a.sub(M16{r15w},Imm8{0x0f});         assert(shouldBe("6641832f0f"));
  a.sub(M16{r15w},r10w);               assert(shouldBe("66452917"));
  a.sub(M32{r15d},Imm32{0xffffffff});  assert(shouldBe("6741812fffffffff"));
  a.sub(M32{r15d},Imm8{0x0f});         assert(shouldBe("6741832f0f"));
  a.sub(M32{r15d},r10d);               assert(shouldBe("67452917"));
  a.sub(M64{r15},Imm32{0xffffffff});   assert(shouldBe("49812fffffffff"));
  a.sub(M64{r15},Imm8{0x0f});          assert(shouldBe("49832f0f"));
  a.sub(M64{r15},r10);                 assert(shouldBe("4d2917"));
  a.sub(M8{r15b},Imm8{0x0f});          assert(shouldBe("41802f0f"));
  a.sub(M8{r15b},r10b);                assert(shouldBe("452817"));
  a.sub(r15w,Imm16{0xffff});           assert(shouldBe("664181efffff"));
  a.sub(r15w,Imm8{0x0f});              assert(shouldBe("664183ef0f"));
  a.sub(r15w,M16{r10w});               assert(shouldBe("66452b3a"));
  a.sub(r15w,r10w);                    assert(shouldBe("664529d7"));
  a.sub(r15d,Imm32{0xffffffff});       assert(shouldBe("4181efffffffff"));
  a.sub(r15d,Imm8{0x0f});              assert(shouldBe("4183ef0f"));
  a.sub(r15d,M32{r10d});               assert(shouldBe("67452b3a"));
  a.sub(r15d,r10d);                    assert(shouldBe("4529d7"));
  a.sub(r15,Imm32{0xffffffff});        assert(shouldBe("4981efffffffff"));
  a.sub(r15,Imm8{0x0f});               assert(shouldBe("4983ef0f"));
  a.sub(r15,M64{r10});                 assert(shouldBe("4d2b3a"));
  a.sub(r15,r10);                      assert(shouldBe("4d29d7"));
  a.sub(r15b,Imm8{0x0f});              assert(shouldBe("4180ef0f"));
  a.sub(r15b,M8{r10b});                assert(shouldBe("452a3a"));
  a.sub(rax,Imm32{0xffffffff});        assert(shouldBe("482dffffffff"));
  a.xor_(al,Imm8{0x0f});               assert(shouldBe("340f"));
  a.xor_(ax,Imm16{0xffff});            assert(shouldBe("6635ffff"));
  a.xor_(eax,Imm32{0xffffffff});       assert(shouldBe("35ffffffff"));
  a.xor_(M16{r15w},Imm16{0xffff});     assert(shouldBe("66418137ffff"));
  a.xor_(M16{r15w},Imm8{0x0f});        assert(shouldBe("664183370f"));
  a.xor_(M16{r15w},r10w);              assert(shouldBe("66453117"));
  a.xor_(M32{r15d},Imm32{0xffffffff}); assert(shouldBe("67418137ffffffff"));
  a.xor_(M32{r15d},Imm8{0x0f});        assert(shouldBe("674183370f"));
  a.xor_(M32{r15d},r10d);              assert(shouldBe("67453117"));
  a.xor_(M64{r15},Imm32{0xffffffff});  assert(shouldBe("498137ffffffff"));
  a.xor_(M64{r15},Imm8{0x0f});         assert(shouldBe("4983370f"));
  a.xor_(M64{r15},r10);                assert(shouldBe("4d3117"));
  a.xor_(M8{r15b},Imm8{0x0f});         assert(shouldBe("4180370f"));
  a.xor_(M8{r15b},r10b);               assert(shouldBe("453017"));
  a.xor_(r15w,Imm16{0xffff});          assert(shouldBe("664181f7ffff"));
  a.xor_(r15w,Imm8{0x0f});             assert(shouldBe("664183f70f"));
  a.xor_(r15w,M16{r10w});              assert(shouldBe("6645333a"));
  a.xor_(r15w,r10w);                   assert(shouldBe("664531d7"));
  a.xor_(r15d,Imm32{0xffffffff});      assert(shouldBe("4181f7ffffffff"));
  a.xor_(r15d,Imm8{0x0f});             assert(shouldBe("4183f70f"));
  a.xor_(r15d,M32{r10d});              assert(shouldBe("6745333a"));
  a.xor_(r15d,r10d);                   assert(shouldBe("4531d7"));
  a.xor_(r15,Imm32{0xffffffff});       assert(shouldBe("4981f7ffffffff"));
  a.xor_(r15,Imm8{0x0f});              assert(shouldBe("4983f70f"));
  a.xor_(r15,M64{r10});                assert(shouldBe("4d333a"));
  a.xor_(r15,r10);                     assert(shouldBe("4d31d7"));
  a.xor_(r15b,Imm8{0x0f});             assert(shouldBe("4180f70f"));
  a.xor_(r15b,M8{r10b});               assert(shouldBe("45323a"));
  a.xor_(rax,Imm32{0xffffffff});       assert(shouldBe("4835ffffffff"));
  a.cmp(al,Imm8{0x0f});                assert(shouldBe("3c0f"));
  a.cmp(ax,Imm16{0xffff});             assert(shouldBe("663dffff"));
  a.cmp(eax,Imm32{0xffffffff});        assert(shouldBe("3dffffffff"));
  a.cmp(M16{r15w},Imm16{0xffff});      assert(shouldBe("6641813fffff"));
  a.cmp(M16{r15w},Imm8{0x0f});         assert(shouldBe("6641833f0f"));
  a.cmp(M16{r15w},r10w);               assert(shouldBe("66453917"));
  a.cmp(M32{r15d},Imm32{0xffffffff});  assert(shouldBe("6741813fffffffff"));
  a.cmp(M32{r15d},Imm8{0x0f});         assert(shouldBe("6741833f0f"));
  a.cmp(M32{r15d},r10d);               assert(shouldBe("67453917"));
  a.cmp(M64{r15},Imm32{0xffffffff});   assert(shouldBe("49813fffffffff"));
  a.cmp(M64{r15},Imm8{0x0f});          assert(shouldBe("49833f0f"));
  a.cmp(M64{r15},r10);                 assert(shouldBe("4d3917"));
  a.cmp(M8{r15b},Imm8{0x0f});          assert(shouldBe("41803f0f"));
  a.cmp(M8{r15b},r10b);                assert(shouldBe("453817"));
  a.cmp(r15w,Imm16{0xffff});           assert(shouldBe("664181ffffff"));
  a.cmp(r15w,Imm8{0x0f});              assert(shouldBe("664183ff0f"));
  a.cmp(r15w,M16{r10w});               assert(shouldBe("66453b3a"));
  a.cmp(r15w,r10w);                    assert(shouldBe("664539d7"));
  a.cmp(r15d,Imm32{0xffffffff});       assert(shouldBe("4181ffffffffff"));
  a.cmp(r15d,Imm8{0x0f});              assert(shouldBe("4183ff0f"));
  a.cmp(r15d,M32{r10d});               assert(shouldBe("67453b3a"));
  a.cmp(r15d,r10d);                    assert(shouldBe("4539d7"));
  a.cmp(r15,Imm32{0xffffffff});        assert(shouldBe("4981ffffffffff"));
  a.cmp(r15,Imm8{0x0f});               assert(shouldBe("4983ff0f"));
  a.cmp(r15,M64{r10});                 assert(shouldBe("4d3b3a"));
  a.cmp(r15,r10);                      assert(shouldBe("4d39d7"));
  a.cmp(r15b,Imm8{0x0f});              assert(shouldBe("4180ff0f"));
  a.cmp(r15b,M8{r10b});                assert(shouldBe("453a3a"));
  a.cmp(rax,Imm32{0xffffffff});        assert(shouldBe("483dffffffff"));
  a.test(al,Imm8{0x0f});               assert(shouldBe("a80f"));
  a.test(ax,Imm16{0xffff});            assert(shouldBe("66a9ffff"));
  a.test(eax,Imm32{0xffffffff});       assert(shouldBe("a9ffffffff"));
  a.test(M16{r15w},Imm16{0xffff});     assert(shouldBe("6641f707ffff"));
  a.test(M16{r15w},r10w);              assert(shouldBe("66458517"));
  a.test(M32{r15d},Imm32{0xffffffff}); assert(shouldBe("6741f707ffffffff"));
  a.test(M32{r15d},r10d);              assert(shouldBe("67458517"));
  a.test(M64{r15},Imm32{0xffffffff});  assert(shouldBe("49f707ffffffff"));
  a.test(M64{r15},r10);                assert(shouldBe("4d8517"));
  a.test(M8{r15b},Imm8{0x0f});         assert(shouldBe("41f6070f"));
  a.test(M8{r15b},r10b);               assert(shouldBe("458417"));
  a.test(r15w,Imm16{0xffff});          assert(shouldBe("6641f7c7ffff"));
  a.test(r15w,r10w);                   assert(shouldBe("664585d7"));
  a.test(r15d,Imm32{0xffffffff});      assert(shouldBe("41f7c7ffffffff"));
  a.test(r15d,r10d);                   assert(shouldBe("4585d7"));
  a.test(r15,Imm32{0xffffffff});       assert(shouldBe("49f7c7ffffffff"));
  a.test(r15,r10);                     assert(shouldBe("4d85d7"));
  a.test(r15b,Imm8{0x0f});             assert(shouldBe("41f6c70f"));
  a.test(rax,Imm32{0xffffffff});       assert(shouldBe("48a9ffffffff"));
  a.mov(M16{r15w},Imm16{0xffff});      assert(shouldBe("6641c707ffff"));
  a.mov(M16{r15w},r10w);               assert(shouldBe("66458917"));
  a.mov(M32{r15d},Imm32{0xffffffff});  assert(shouldBe("6741c707ffffffff"));
  a.mov(M32{r15d},r10d);               assert(shouldBe("67458917"));
  a.mov(M64{r15},Imm32{0xffffffff});   assert(shouldBe("49c707ffffffff"));
  a.mov(M64{r15},r10);                 assert(shouldBe("4d8917"));
  a.mov(M8{r15b},Imm8{0x0f});          assert(shouldBe("41c6070f"));
  a.mov(M8{r15b},r10b);                assert(shouldBe("458817"));
  a.mov(r15w,Imm16{0xffff});           assert(shouldBe("6641bfffff"));
  a.mov(r15w,M16{r10w});               assert(shouldBe("66458b3a"));
  a.mov(r15w,r10w);                    assert(shouldBe("664589d7"));
  a.mov(r15d,Imm32{0xffffffff});       assert(shouldBe("41bfffffffff"));
  a.mov(r15d,M32{r10d});               assert(shouldBe("67458b3a"));
  a.mov(r15d,r10d);                    assert(shouldBe("4589d7"));
  // a.mov(r15,Imm32{0xffffffff});     assert(shouldBe("41bfffffffff"));
  a.mov(r15,Imm64{0xfffffffff});       assert(shouldBe("49bfffffffff0f000000"));
  a.mov(r15,M64{r10});                 assert(shouldBe("4d8b3a"));
  a.mov(r15,r10);                      assert(shouldBe("4d89d7"));
  a.mov(r15b,Imm8{0x0f});              assert(shouldBe("41b70f"));
  a.mov(r15b,M8{r10b});                assert(shouldBe("458a3a"));
  a.rol(M16{r15w},cl);                 assert(shouldBe("6641d307"));
  a.rol(M16{r15w},Imm8{0x0f});         assert(shouldBe("6641c1070f"));
  a.rol(M16{r15w},One{});                assert(shouldBe("6641d107"));
  a.rol(M32{r15d},cl);                 assert(shouldBe("6741d307"));
  a.rol(M32{r15d},Imm8{0x0f});         assert(shouldBe("6741c1070f"));
  a.rol(M32{r15d},One{});                assert(shouldBe("6741d107"));
  a.rol(M64{r15},cl);                  assert(shouldBe("49d307"));
  a.rol(M64{r15},Imm8{0x0f});          assert(shouldBe("49c1070f"));
  a.rol(M64{r15},One{});                 assert(shouldBe("49d107"));
  a.rol(M8{r15b},cl);                  assert(shouldBe("41d207"));
  a.rol(M8{r15b},Imm8{0x0f});          assert(shouldBe("41c0070f"));
  a.rol(M8{r15b},One{});                 assert(shouldBe("41d007"));
  a.rol(r15w,cl);                      assert(shouldBe("6641d3c7"));
  a.rol(r15w,Imm8{0x0f});              assert(shouldBe("6641c1c70f"));
  a.rol(r15w,One{});                     assert(shouldBe("6641d1c7"));
  a.rol(r15d,cl);                      assert(shouldBe("41d3c7"));
  a.rol(r15d,Imm8{0x0f});              assert(shouldBe("41c1c70f"));
  a.rol(r15d,One{});                     assert(shouldBe("41d1c7"));
  a.rol(r15,cl);                       assert(shouldBe("49d3c7"));
  a.rol(r15,Imm8{0x0f});               assert(shouldBe("49c1c70f"));
  a.rol(r15,One{});                      assert(shouldBe("49d1c7"));
  a.rol(r15b,cl);                      assert(shouldBe("41d2c7"));
  a.rol(r15b,Imm8{0x0f});              assert(shouldBe("41c0c70f"));
  a.rol(r15b,One{});                     assert(shouldBe("41d0c7"));
  a.ror(M16{r15w},cl);                 assert(shouldBe("6641d30f"));
  a.ror(M16{r15w},Imm8{0x0f});         assert(shouldBe("6641c10f0f"));
  a.ror(M16{r15w},One{});                assert(shouldBe("6641d10f"));
  a.ror(M32{r15d},cl);                 assert(shouldBe("6741d30f"));
  a.ror(M32{r15d},Imm8{0x0f});         assert(shouldBe("6741c10f0f"));
  a.ror(M32{r15d},One{});                assert(shouldBe("6741d10f"));
  a.ror(M64{r15},cl);                  assert(shouldBe("49d30f"));
  a.ror(M64{r15},Imm8{0x0f});          assert(shouldBe("49c10f0f"));
  a.ror(M64{r15},One{});                 assert(shouldBe("49d10f"));
  a.ror(M8{r15b},cl);                  assert(shouldBe("41d20f"));
  a.ror(M8{r15b},Imm8{0x0f});          assert(shouldBe("41c00f0f"));
  a.ror(M8{r15b},One{});                 assert(shouldBe("41d00f"));
  a.ror(r15w,cl);                      assert(shouldBe("6641d3cf"));
  a.ror(r15w,Imm8{0x0f});              assert(shouldBe("6641c1cf0f"));
  a.ror(r15w,One{});                     assert(shouldBe("6641d1cf"));
  a.ror(r15d,cl);                      assert(shouldBe("41d3cf"));
  a.ror(r15d,Imm8{0x0f});              assert(shouldBe("41c1cf0f"));
  a.ror(r15d,One{});                     assert(shouldBe("41d1cf"));
  a.ror(r15,cl);                       assert(shouldBe("49d3cf"));
  a.ror(r15,Imm8{0x0f});               assert(shouldBe("49c1cf0f"));
  a.ror(r15,One{});                      assert(shouldBe("49d1cf"));
  a.ror(r15b,cl);                      assert(shouldBe("41d2cf"));
  a.ror(r15b,Imm8{0x0f});              assert(shouldBe("41c0cf0f"));
  a.ror(r15b,One{});                     assert(shouldBe("41d0cf"));
  a.rcl(M16{r15w},cl);                 assert(shouldBe("6641d317"));
  a.rcl(M16{r15w},Imm8{0x0f});         assert(shouldBe("6641c1170f"));
  a.rcl(M16{r15w},One{});                assert(shouldBe("6641d117"));
  a.rcl(M32{r15d},cl);                 assert(shouldBe("6741d317"));
  a.rcl(M32{r15d},Imm8{0x0f});         assert(shouldBe("6741c1170f"));
  a.rcl(M32{r15d},One{});                assert(shouldBe("6741d117"));
  a.rcl(M64{r15},cl);                  assert(shouldBe("49d317"));
  a.rcl(M64{r15},Imm8{0x0f});          assert(shouldBe("49c1170f"));
  a.rcl(M64{r15},One{});                 assert(shouldBe("49d117"));
  a.rcl(M8{r15b},cl);                  assert(shouldBe("41d217"));
  a.rcl(M8{r15b},Imm8{0x0f});          assert(shouldBe("41c0170f"));
  a.rcl(M8{r15b},One{});                 assert(shouldBe("41d017"));
  a.rcl(r15w,cl);                      assert(shouldBe("6641d3d7"));
  a.rcl(r15w,Imm8{0x0f});              assert(shouldBe("6641c1d70f"));
  a.rcl(r15w,One{});                     assert(shouldBe("6641d1d7"));
  a.rcl(r15d,cl);                      assert(shouldBe("41d3d7"));
  a.rcl(r15d,Imm8{0x0f});              assert(shouldBe("41c1d70f"));
  a.rcl(r15d,One{});                     assert(shouldBe("41d1d7"));
  a.rcl(r15,cl);                       assert(shouldBe("49d3d7"));
  a.rcl(r15,Imm8{0x0f});               assert(shouldBe("49c1d70f"));
  a.rcl(r15,One{});                      assert(shouldBe("49d1d7"));
  a.rcl(r15b,cl);                      assert(shouldBe("41d2d7"));
  a.rcl(r15b,Imm8{0x0f});              assert(shouldBe("41c0d70f"));
  a.rcl(r15b,One{});                     assert(shouldBe("41d0d7"));
  a.rcr(M16{r15w},cl);                 assert(shouldBe("6641d31f"));
  a.rcr(M16{r15w},Imm8{0x0f});         assert(shouldBe("6641c11f0f"));
  a.rcr(M16{r15w},One{});                assert(shouldBe("6641d11f"));
  a.rcr(M32{r15d},cl);                 assert(shouldBe("6741d31f"));
  a.rcr(M32{r15d},Imm8{0x0f});         assert(shouldBe("6741c11f0f"));
  a.rcr(M32{r15d},One{});                assert(shouldBe("6741d11f"));
  a.rcr(M64{r15},cl);                  assert(shouldBe("49d31f"));
  a.rcr(M64{r15},Imm8{0x0f});          assert(shouldBe("49c11f0f"));
  a.rcr(M64{r15},One{});                 assert(shouldBe("49d11f"));
  a.rcr(M8{r15b},cl);                  assert(shouldBe("41d21f"));
  a.rcr(M8{r15b},Imm8{0x0f});          assert(shouldBe("41c01f0f"));
  a.rcr(M8{r15b},One{});                 assert(shouldBe("41d01f"));
  a.rcr(r15w,cl);                      assert(shouldBe("6641d3df"));
  a.rcr(r15w,Imm8{0x0f});              assert(shouldBe("6641c1df0f"));
  a.rcr(r15w,One{});                     assert(shouldBe("6641d1df"));
  a.rcr(r15d,cl);                      assert(shouldBe("41d3df"));
  a.rcr(r15d,Imm8{0x0f});              assert(shouldBe("41c1df0f"));
  a.rcr(r15d,One{});                     assert(shouldBe("41d1df"));
  a.rcr(r15,cl);                       assert(shouldBe("49d3df"));
  a.rcr(r15,Imm8{0x0f});               assert(shouldBe("49c1df0f"));
  a.rcr(r15,One{});                      assert(shouldBe("49d1df"));
  a.rcr(r15b,cl);                      assert(shouldBe("41d2df"));
  a.rcr(r15b,Imm8{0x0f});              assert(shouldBe("41c0df0f"));
  a.rcr(r15b,One{});                     assert(shouldBe("41d0df"));
  a.shl(M16{r15w},cl);                 assert(shouldBe("6641d327"));
  a.shl(M16{r15w},Imm8{0x0f});         assert(shouldBe("6641c1270f"));
  a.shl(M16{r15w},One{});                assert(shouldBe("6641d127"));
  a.shl(M32{r15d},cl);                 assert(shouldBe("6741d327"));
  a.shl(M32{r15d},Imm8{0x0f});         assert(shouldBe("6741c1270f"));
  a.shl(M32{r15d},One{});                assert(shouldBe("6741d127"));
  a.shl(M64{r15},cl);                  assert(shouldBe("49d327"));
  a.shl(M64{r15},Imm8{0x0f});          assert(shouldBe("49c1270f"));
  a.shl(M64{r15},One{});                 assert(shouldBe("49d127"));
  a.shl(M8{r15b},cl);                  assert(shouldBe("41d227"));
  a.shl(M8{r15b},Imm8{0x0f});          assert(shouldBe("41c0270f"));
  a.shl(M8{r15b},One{});                 assert(shouldBe("41d027"));
  a.shl(r15w,cl);                      assert(shouldBe("6641d3e7"));
  a.shl(r15w,Imm8{0x0f});              assert(shouldBe("6641c1e70f"));
  a.shl(r15w,One{});                     assert(shouldBe("6641d1e7"));
  a.shl(r15d,cl);                      assert(shouldBe("41d3e7"));
  a.shl(r15d,Imm8{0x0f});              assert(shouldBe("41c1e70f"));
  a.shl(r15d,One{});                     assert(shouldBe("41d1e7"));
  a.shl(r15,cl);                       assert(shouldBe("49d3e7"));
  a.shl(r15,Imm8{0x0f});               assert(shouldBe("49c1e70f"));
  a.shl(r15,One{});                      assert(shouldBe("49d1e7"));
  a.shl(r15b,cl);                      assert(shouldBe("41d2e7"));
  a.shl(r15b,Imm8{0x0f});              assert(shouldBe("41c0e70f"));
  a.shl(r15b,One{});                     assert(shouldBe("41d0e7"));
  a.shr(M16{r15w},cl);                 assert(shouldBe("6641d32f"));
  a.shr(M16{r15w},Imm8{0x0f});         assert(shouldBe("6641c12f0f"));
  a.shr(M16{r15w},One{});                assert(shouldBe("6641d12f"));
  a.shr(M32{r15d},cl);                 assert(shouldBe("6741d32f"));
  a.shr(M32{r15d},Imm8{0x0f});         assert(shouldBe("6741c12f0f"));
  a.shr(M32{r15d},One{});                assert(shouldBe("6741d12f"));
  a.shr(M64{r15},cl);                  assert(shouldBe("49d32f"));
  a.shr(M64{r15},Imm8{0x0f});          assert(shouldBe("49c12f0f"));
  a.shr(M64{r15},One{});                 assert(shouldBe("49d12f"));
  a.shr(M8{r15b},cl);                  assert(shouldBe("41d22f"));
  a.shr(M8{r15b},Imm8{0x0f});          assert(shouldBe("41c02f0f"));
  a.shr(M8{r15b},One{});                 assert(shouldBe("41d02f"));
  a.shr(r15w,cl);                      assert(shouldBe("6641d3ef"));
  a.shr(r15w,Imm8{0x0f});              assert(shouldBe("6641c1ef0f"));
  a.shr(r15w,One{});                     assert(shouldBe("6641d1ef"));
  a.shr(r15d,cl);                      assert(shouldBe("41d3ef"));
  a.shr(r15d,Imm8{0x0f});              assert(shouldBe("41c1ef0f"));
  a.shr(r15d,One{});                     assert(shouldBe("41d1ef"));
  a.shr(r15,cl);                       assert(shouldBe("49d3ef"));
  a.shr(r15,Imm8{0x0f});               assert(shouldBe("49c1ef0f"));
  a.shr(r15,One{});                      assert(shouldBe("49d1ef"));
  a.shr(r15b,cl);                      assert(shouldBe("41d2ef"));
  a.shr(r15b,Imm8{0x0f});              assert(shouldBe("41c0ef0f"));
  a.shr(r15b,One{});                     assert(shouldBe("41d0ef"));
  a.sar(M16{r15w},cl);                 assert(shouldBe("6641d33f"));
  a.sar(M16{r15w},Imm8{0x0f});         assert(shouldBe("6641c13f0f"));
  a.sar(M16{r15w},One{});                assert(shouldBe("6641d13f"));
  a.sar(M32{r15d},cl);                 assert(shouldBe("6741d33f"));
  a.sar(M32{r15d},Imm8{0x0f});         assert(shouldBe("6741c13f0f"));
  a.sar(M32{r15d},One{});                assert(shouldBe("6741d13f"));
  a.sar(M64{r15},cl);                  assert(shouldBe("49d33f"));
  a.sar(M64{r15},Imm8{0x0f});          assert(shouldBe("49c13f0f"));
  a.sar(M64{r15},One{});                 assert(shouldBe("49d13f"));
  a.sar(M8{r15b},cl);                  assert(shouldBe("41d23f"));
  a.sar(M8{r15b},Imm8{0x0f});          assert(shouldBe("41c03f0f"));
  a.sar(M8{r15b},One{});                 assert(shouldBe("41d03f"));
  a.sar(r15w,cl);                      assert(shouldBe("6641d3ff"));
  a.sar(r15w,Imm8{0x0f});              assert(shouldBe("6641c1ff0f"));
  a.sar(r15w,One{});                     assert(shouldBe("6641d1ff"));
  a.sar(r15d,cl);                      assert(shouldBe("41d3ff"));
  a.sar(r15d,Imm8{0x0f});              assert(shouldBe("41c1ff0f"));
  a.sar(r15d,One{});                     assert(shouldBe("41d1ff"));
  a.sar(r15,cl);                       assert(shouldBe("49d3ff"));
  a.sar(r15,Imm8{0x0f});               assert(shouldBe("49c1ff0f"));
  a.sar(r15,One{});                      assert(shouldBe("49d1ff"));
  a.sar(r15b,cl);                      assert(shouldBe("41d2ff"));
  a.sar(r15b,Imm8{0x0f});              assert(shouldBe("41c0ff0f"));
  a.sar(r15b,One{});                     assert(shouldBe("41d0ff"));
  a.xchg(ax,r15w);                     assert(shouldBe("664197"));
  a.xchg(eax,r15d);                    assert(shouldBe("4197"));
  a.xchg(M16{r15w},r10w);              assert(shouldBe("66458717"));
  a.xchg(M32{r15d},r10d);              assert(shouldBe("67458717"));
  a.xchg(M64{r15},r10);                assert(shouldBe("4d8717"));
  a.xchg(M8{r15b},r10b);               assert(shouldBe("458617"));
  a.xchg(r15w,ax);                     assert(shouldBe("664197"));
  a.xchg(r15w,r10w);                   assert(shouldBe("664587d7"));
  a.xchg(r15d,eax);                    assert(shouldBe("4197"));
  a.xchg(r15d,r10d);                   assert(shouldBe("4587d7"));
  a.xchg(r15,r10);                assert(shouldBe("4d87d7"));
  a.xchg(r15,rax);                assert(shouldBe("4997"));
  a.xchg(rax,r15);                assert(shouldBe("4997"));
  a.movd(M32{r15d},xmm7);              assert(shouldBe("6766410f7e3f"));
  a.movd(r15d,xmm7);                   assert(shouldBe("66410f7eff"));
  a.movd(xmm7,M32{r15d});              assert(shouldBe("6766410f6e3f"));
  a.movd(xmm7,r15d);                   assert(shouldBe("66410f6eff"));
  a.movq_1(M64{r15},xmm7);             assert(shouldBe("66410fd63f"));
  // a.movq_1(r15,xmm7);               assert(shouldBe("66410fd6ff"));
  a.movq_1(xmm7,xmm4);                 assert(shouldBe("660fd6e7"));
  a.movdqa(M128{xmm7},xmm4);           assert(shouldBe("660f7f27"));
  // a.movdqa(xmm7,M128{xmm4});      assert(shouldBe("660f6f3c24"));
  a.movdqa(xmm7,xmm4);                 assert(shouldBe("660f6ffc"));
  // a.paddb(xmm7,M128{xmm4});          assert(shouldBe("660ffc3c24")); // todo
  a.paddb(xmm7,xmm4);                  assert(shouldBe("660ffcfc"));
  // a.paddw(xmm7,M128{xmm4});          assert(shouldBe("660ffd3c24")); // todo
  a.paddw(xmm7,xmm4);                  assert(shouldBe("660ffdfc"));
  // a.paddd(xmm7,M128{xmm4});          assert(shouldBe("660ffe3c24"));
  a.paddd(xmm7,xmm4);                  assert(shouldBe("660ffefc"));
  // a.paddq(xmm7,M128{xmm4});          assert(shouldBe("660fd43c24"));
  a.paddq(xmm7,xmm4);                  assert(shouldBe("660fd4fc"));
  // a.psubb(xmm7,M128{xmm4});          assert(shouldBe("660ff83c24"));
  a.psubb(xmm7,xmm4);                  assert(shouldBe("660ff8fc"));
  // a.psubw(xmm7,M128{xmm4});          assert(shouldBe("660ff93c24"));
  a.psubw(xmm7,xmm4);                  assert(shouldBe("660ff9fc"));
  // a.psubd(xmm7,M128{xmm4});          assert(shouldBe("660ffa3c24"));
  a.psubd(xmm7,xmm4);                  assert(shouldBe("660ffafc"));
  // a.psubq(xmm7,M128{xmm4});          assert(shouldBe("660ffb3c24"));
  a.psubq(xmm7,xmm4);                  assert(shouldBe("660ffbfc"));
  // a.pxor(xmm7,M128{xmm4});           assert(shouldBe("660fef3c24"));
  a.pxor(xmm7,xmm4);                   assert(shouldBe("660feffc"));
  // a.psllw(xmm7,Imm8{0x0f});         assert(shouldBe("660f71d70f"));
  // a.pslld(xmm7,Imm8{0x0f});         assert(shouldBe("660f72d70f"));
  // a.psllq(xmm7,Imm8{0x0f});         assert(shouldBe("660f73d70f"));
  // a.pslldq(xmm7,Imm8{0x0f});        assert(shouldBe("660f73ff0f"));
  // a.psrlw(xmm7,Imm8{0x0f});         assert(shouldBe("660f71f70f"));
  // a.psrld(xmm7,Imm8{0x0f});         assert(shouldBe("660f72f70f"));
  // a.psrlq(xmm7,Imm8{0x0f});         assert(shouldBe("660f73f70f"));
  a.psrldq(xmm7,Imm8{0x0f});           assert(shouldBe("660f73df0f"));
  a.psraw(xmm7,Imm8{0x0f});            assert(shouldBe("660f71e70f"));
  a.psrad(xmm7,Imm8{0x0f});            assert(shouldBe("660f72e70f"));
  a.lea(r15w,M16{r10w});               assert(shouldBe("66458d3a"));
  // a.lea(r15w,M32{r10d});          assert(shouldBe("6667458d3a"));
  a.lea(r15w,M64{r10});                assert(shouldBe("66458d3a"));
  a.lea(r15d,M16{r10w});               assert(shouldBe("458d3a"));
  a.lea(r15d,M32{r10d});               assert(shouldBe("67458d3a"));
  a.lea(r15d,M64{r10});                assert(shouldBe("458d3a"));
  a.lea(r15,M16{r10w});                assert(shouldBe("4d8d3a"));
  a.lea(r15,M32{r10d});                assert(shouldBe("674d8d3a"));
  a.lea(r15,M64{r10});                 assert(shouldBe("4d8d3a"));
  a.pop(M64{r15});                     assert(shouldBe("418f07"));
  a.pop_1(r15);                        assert(shouldBe("415f"));
  a.push(M64{r15});                    assert(shouldBe("41ff37"));
  a.push_1(r15);                       assert(shouldBe("4157"));
  a.call(M64{r15});                    assert(shouldBe("41ff17"));
  a.call(r15);                         assert(shouldBe("41ffd7"));

  return 0;
}
